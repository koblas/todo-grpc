{
	auto_https disable_redirects
}

:80 :443 {
	encode gzip

	handle_path /api/v1/auth/* {
		rewrite * /twirp/api.auth.AuthenticationService{path}
		reverse_proxy public-auth:14586
	}

	handle_path /api/v1/todo/* {
		rewrite * /twirp/api.todo.TodoService{path}
		reverse_proxy public-todo:14586
	}

	handle_path /wsapi/* {
		reverse_proxy public-websocket:14586
	}
	handle_path /wsapi {
		reverse_proxy public-websocket:14586
	}

	handle {
		root * /home/static
		try_files {path} {file} /index.html
		file_server
	}
}
